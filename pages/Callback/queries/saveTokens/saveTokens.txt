INSERT INTO public.credenciais_clientes
  (client_id, app_id, conn_label, title, access_token, refresh_token, "CODIGO_AUTORIZACAO")
VALUES
  (
    {{ appsmith.store.ca_client_row_id }},
    {{ getCAApp.data[0].id }},
    {{ appsmith.store.conn_label || 'default' }},
    {{ "'CA:" + appsmith.store.ca_client_row_id + ":" + getCAApp.data[0].id + ":" + (appsmith.store.conn_label || 'default') }},
    {{ CA_Token.data.access_token }},
    {{ CA_Token.data.refresh_token }},
    {{ appsmith.URL.queryParams.code }}
  )
ON CONFLICT (client_id, app_id, conn_label)
DO UPDATE SET
  access_token         = EXCLUDED.access_token,
  refresh_token        = EXCLUDED.refresh_token,
  "CODIGO_AUTORIZACAO" = EXCLUDED."CODIGO_AUTORIZACAO"
RETURNING id;
